"""Remove NSD from experiment table

Revision ID: 746ce4ade43f
Revises: 08c8c78dbeaf
Create Date: 2020-04-13 12:21:53.893334

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.sql import text


# revision identifiers, used by Alembic.
revision = '746ce4ade43f'
down_revision = '08c8c78dbeaf'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    # op.drop_column('experiment', 'NSD')
    # ### end Alembic commands ###

    # ALTER commands for sqlite
    op.get_bind().execute(text("""
        create table experiment_dg_tmp
        (
	        id INTEGER not null primary key,
	        user_id INTEGER references user(id),
	        name VARCHAR(64),
	        type VARCHAR(32),
	        automated BOOLEAN,
	        test_cases VARCHAR,
	        ues VARCHAR,
	        slice VARCHAR(64)
        );
    """))

    op.get_bind().execute(text("""
        insert into experiment_dg_tmp(id, user_id, name, type, automated, test_cases, ues, slice) select id, user_id, name, type, unattended, test_cases, ues, slice from experiment;
    """))

    op.get_bind().execute(text("""
        drop table experiment;
    """))

    op.get_bind().execute(text("""
        alter table experiment_dg_tmp rename to experiment;
    """))


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('experiment', sa.Column('NSD', sa.VARCHAR(length=256), nullable=True))
    # ### end Alembic commands ###
